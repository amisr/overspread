        <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
          "http://www.w3.org/TR/html40/loose.dtd">

        <html>
         
        <head>
        <title>Class: MadrigalInstrumentKindats</title>
        </head>

<BODY BGCOLOR=#FFFFFF LINK=#008000 VLINK=#003366>

        <p><i><a href="index.html">Table of Contents</a></i></p>
        
        <table border="0" cellpadding="5" cellspacing="0" width="100%">
        <tr bgcolor="#88bbee">
            <th rowspan="2"
                valign="top"
                align="left"
                width="10%"><font color="#000000">Class: MadrigalInstrumentKindats</font>
            </th>
            <th align="right"><font color="#000000">metadata.py</font></th>
        </tr>
        <tr>
        <td>
        <h3>MadrigalInstrumentKindats is an object that provides access to the metadata file that summarizes the kindat codes associated with each instrument.</h3>
<p>    This object provides access to all Madrigal instrument kindat information in the metadata file instKindatTab.txt.
    The metadata file instKindatTab.txt lists, for any given instrument, all the kindat codes found in all the
    data files in the database associated with that instrument.</p>

<p>    This class also contains a method to rebuild the table instKindatTab.txt by examining all the metadata in the database.
    This is presumably a somewhat slow process and should be done in the background.</p>

<p>    Usage example:</p>
<PRE>
        import madrigal.metadata

        import madrigal.admin

        try:

            test = madrigal.metadata.MadrigalInstrumentKindats()

            print test.getKindatListForInstruments([20,30])

        except madrigal.admin.MadrigalError, e:

            print e.getExceptionStr()

</PRE>

<p>    Non-standard Python modules used:
    None</p>

<p>    MadrigalError exception thrown if:</p>
<ol><li><p>MadrigalMetadata fails to open or parse metadata file</p>

</li></ol>

<p>    Change history:</p>

<p>    Written by <a href="mailto:wrideout@haystack.mit.edu">Bill Rideout</a>  Aug. 15, 2002</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Methods">Methods</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
<a href="#__init__">__init__</a><br>
<a href="#getKindatListForInstruments">getKindatListForInstruments</a><br>
<a href="#rebuildInstKindatTable">rebuildInstKindatTable</a><br>


        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="__init__"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">__init__&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
__init__ (
        self,
        madDB=None,
        initFile=None,
        )

</pre></font>
<h3>__init__ initializes MadrigalInstrumentKindats by reading from instKindatTab.txt (or initFile).</h3>
<h4>Inputs: Existing MadrigalDB object, by default = None.</h4>
<p>            String representing the full path to the metadata file. Default is None, in
            which case file read is MadrigalDB.getMetadataDir()/instKindatTab.txt.</p>


<p>        Returns: void</p>

<p>        Affects: Initializes all the class member variables.</p>

<p>        Exceptions: MadrigalError thrown  by MadrigalMetadata if file not opened or parsed successfully.
        Note that the instKindatTab.txt file was new with the release of the madrigal python api, and this
        function will throw an error if file not there.</p>



        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="getKindatListForInstruments"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">getKindatListForInstruments&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
getKindatListForInstruments ( self,  kinstList )

</pre></font>
<h3>getKindatListForInstruments returns a list of kindat codes as integers for the given instrument list.</h3>
<p>        Inputs: kinstList: a list of kinst integers to get associated kindat list. Also accepts a single integer.</p>

<p>        Returns: a list of kindat codes as integers associated with the given instrument list.</p>

<p>        Affects: None</p>

<p>        Exceptions: if error in metadata file</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
madrigal.admin.MadrigalError('Error in instKindatTab.txt parsing metadata row: ' + str( inst ), traceback.format_exception(sys.exc_info() [ 0 ], sys.exc_info() [ 1 ], sys.exc_info() [ 2 ] ) )<br>

</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="rebuildInstKindatTable"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">rebuildInstKindatTable&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
rebuildInstKindatTable ( self )

</pre></font>
<h3>rebuildInstKindatTable rebuilds the instKindatTab.txt metadata file.</h3>
<p>        The table instKindatTab.txt is a listing of every kindat found for a given
        instrument.  Since these files are constantly updated, this table needs to be updated on a regular
        basis. Data from other Madrigal sites is also imported into this table.</p>

<p>        How it works: For each instrument in instTab.txt, this method first creates a list
        of all the experiments that used that instrument.  It then loops
        through the file table.  For each file listing, if the file is the
        default one, and its experiment id is in the list of experiments just
        created, the kindat is added to the list if its not already there.
        Data from all other Madrigal sites is then added via getMetadata.  It then writes
        the metadata file in the form: 10, 1001 1002 1003, where the first column in the
        instrument code and the second column is a space delimited list of kindat codes.</p>

<p>        Inputs: None.</p>

<p>        Returns: None.</p>

<p>        Affects: Writes file instKindatTab.txt in metadata directory</p>

<p>        Exceptions: If unable to write instKindatTab.txt file.</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
madrigal.admin.MadrigalError( 'Unable to write: ' + str( filename ), None )<br>

</td></tr>
</table>
</td></tr>
</td></tr>
</table>

        </td>
        </tr>
        </table>

        <hr>

        <p><i><a href="index.html">Table of Contents</a></i></p>

        <font size="-2"><i>This document was automatically generated
        on Fri Dec 30 08:58:50 2005 by
        <a href="http://happydoc.sourceforge.net">HappyDoc</a> version
        r1_5</i></font>
        
        </body>
        </html>
        
