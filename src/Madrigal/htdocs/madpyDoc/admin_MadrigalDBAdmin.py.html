        <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
          "http://www.w3.org/TR/html40/loose.dtd">

        <html>
         
        <head>
        <title>Class: MadrigalDBAdmin</title>
        </head>

<BODY BGCOLOR=#FFFFFF LINK=#008000 VLINK=#003366>

        <p><i><a href="index.html">Table of Contents</a></i></p>
        
        <table border="0" cellpadding="5" cellspacing="0" width="100%">
        <tr bgcolor="#88bbee">
            <th rowspan="2"
                valign="top"
                align="left"
                width="10%"><font color="#000000">Class: MadrigalDBAdmin</font>
            </th>
            <th align="right"><font color="#000000">admin.py</font></th>
        </tr>
        <tr>
        <td>
        <h3>MadrigalDBAdmin is a class that allows modifications to be made to the Madrigal database</h3>
<p>    dbAdminObj = madrigal.admin.MadrigalDBAdmin()</p>

<p>    expDir = dbAdminObj.createMadrigalExperiment(<code>/home/hyperion/brideout/mlh050429c.000</code>,
                                        <code>Dummy experiment</code>,
                                        0,
                                        <code>test exp</code>,
                                        30,
                                        1)</p>

<p>    Non-standard Python modules used: None</p>

<p>    Change history:</p>

<p>    Written by <a href="mailto:wrideout@haystack.mit.edu">Bill Rideout</a>  May. 5, 2005</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Methods">Methods</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        

            <table border="0" cellspacing="2" cellpadding="2" width="100%">
              <tr>
            <td align="LEFT" valign="TOP">
<a href="#__checkOpenMadrigalMetadata__">__checkOpenMadrigalMetadata__</a><br>
<a href="#__init__">__init__</a><br>
<a href="#__updateGlobalMetadata__">__updateGlobalMetadata__</a><br>
<a href="#__updateLocalMetadata__">__updateLocalMetadata__</a><br>
<a href="#__walkExpDir__">__walkExpDir__</a><br>
<a href="#addMadrigalFile">addMadrigalFile</a><br>
<a href="#addWebFile">addWebFile</a><br>
<a href="#appendRTMadrigalFile">appendRTMadrigalFile</a><br>
<a href="#changeExpStatus">changeExpStatus</a><br>
<a href="#changeFileStatus">changeFileStatus</a><br>
</td>
<td align="LEFT" valign="TOP">
<a href="#createMadrigalExperiment">createMadrigalExperiment</a><br>
<a href="#createRTExperiment">createRTExperiment</a><br>
<a href="#overwriteMadrigalFile">overwriteMadrigalFile</a><br>
<a href="#removeMadrigalFile">removeMadrigalFile</a><br>
<a href="#updateExpTab">updateExpTab</a><br>
<a href="#updateMaster">updateMaster</a><br>
<a href="#writeRTMadrigalFile">writeRTMadrigalFile</a><br>
</td>
</tr>
            </table>
            

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="__checkOpenMadrigalMetadata__"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">__checkOpenMadrigalMetadata__&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
__checkOpenMadrigalMetadata__ ( self )

</pre></font>
<p>__checkOpenMadrigalMetadata__ is a method that check the openmadrigal site for any
        updates to the following metadata files:</p>
<ol><li><p>siteTab.txt - the list of all Madrigal installations
            2. instTab.txt - the list of all Madrigal instruments
            3. instType.txt - the list of all instrument categories</p>

</li></ol>
<p>        If an update is available, and the existing metadata file is an old one, it will be updated.
        However, if the local Madrigal adminstrator edits one of these files, then the file will
        not be updated.  If you want to change these files, it is best to contact the OpenMadrigal
        development administrator (madrigal@haystack.mit.edu)</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
IOError, 'Problem with url %s' %( thisUrl )<br>

</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="__init__"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">__init__&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
__init__ ( self,  madDB=None )

</pre></font>
<h3>__init__ initializes MadrigalDBAdmin</h3>
<p>        Inputs: madDB - Existing MadrigalDB object.  Default = None.</p>

<p>        Returns: void</p>

<p>        Affects:</p>
<p>            Sets self.__madDB to MadrigalDB object
            Sets self.__madInst to MadrigalInstrument object</p>




        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="__updateGlobalMetadata__"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">__updateGlobalMetadata__&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
__updateGlobalMetadata__ ( self )

</pre></font>
<p>__updateGlobalMetadata__ is a private method to update metadata/expTabAll.txt and metadata/fileTabAll.txt
        from the main madrigal server.</p>


        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="__updateLocalMetadata__"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">__updateLocalMetadata__&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
__updateLocalMetadata__ ( self )

</pre></font>
<p>__updateLocalMetadata__ is a private method to update metadata/expTab.txt and metadata/fileTab.txt
        from the local metadata in the experiments directory</p>


        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="__walkExpDir__"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">__walkExpDir__&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
__walkExpDir__ (
        self,
        arg,
        dirname,
        names,
        )

</pre></font>
<p>__walkExpDir__ is a private method called by os.path.walk.  arg is a dict with keys:
        1. extText = text of combined expTab.txt to be appended to
        2. fileText = text of combined fileTab.txt to be appended to
        3. presentCount = total experiments done so far
        4. localSiteId = local site id (int)</p>
<p>        Sets values in arg</p>



        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="addMadrigalFile"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">addMadrigalFile&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
addMadrigalFile (
        self,
        expDir,
        madFilename,
        permission,
        fileDesc,
        category=1,
        kindat=None,
        )

</pre></font>
<h3>addMadrigalFile adds a new file to an experiment using metadata read from madFilename.</h3>
<p>        Inputs:</p>
<p>            expDir - full path to experiment directory (as returned by createMadriogalExperiment)</p>

<p>            madFilename - full path to the complete Madrigal file.  Basename will be maintained.</p>

<p>            permission - 0 (public) or 1 (private). </p>

<p>            fileDesc - file description</p>

<p>            category - 1=default, 2=variant, 3=history, or 4=realtime. Default is 1 (default file)</p>

<p>            kindat - if not None (the default), use this kindat instead of what is found in the file.</p>


<p>        Returns: None</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
'File %s already exists - must be deleted first' %( filename )<br>
ValueError, ' file %s does not yet exist' %(os.path.join( expDir, 'fileTab.txt' ) )<br>
ValueError, 'More than one kindat value found in file: %s' %(str( kindatList ) )<br>
ValueError, 'No kindat values found in file'<br>
ValueError, 'category must be 1=default, 2=variant, 3=history, or 4=realtime; not %s' %(str( category ) )<br>
ValueError, 'fileDesc not a string'<br>
ValueError, 'fileDesc string in fileTab.txt cannot contain a comma: <%s> is illegal' %( fileDesc )<br>
ValueError, 'permission must be either 0 or 1, not %s' %(str( permission ) )<br>

</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="addWebFile"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">addWebFile&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
addWebFile (
        self,
        expDir,
        source,
        relativePath,
        )

</pre></font>
<h3>addWebFile writes a non-Madrigal file meant to be displayed on the web to somewhere within a Madrigal experiment directory.</h3>
<p>            All needed directories will be created if needed.</p>

<p>            Inputs:</p>
<p>                expDir - full path to experiment directory</p>

<p>                source - local web file to write to Madrigal</p>

<p>                relativePath - path relative to expDir to write source file to.  If relativePath ends
                with /, then basename from source used.  Otherwise, basename from relativePath used.</p>


<p>            Returns: None</p>

<p>            Affects: writes a non-Madrigal file to expDir on Madrigal</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
ValueError, '%s not a valid experiment directory - no fileTab.txt' %( expDir )<br>

</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="appendRTMadrigalFile"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">appendRTMadrigalFile&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
appendRTMadrigalFile (
        self,
        expDir,
        rtFilename,
        rtFile,
        )

</pre></font>
<h3>appendRTMadrigalFile allows appending to a realtime Madrigal file.</h3>
<p>        Fails if rtFilename does not match one listed in fileTab.txt.  If the file doesn't exist, will
        create it, and will then check that the format is unblocked binary.  This is because unblocked binary
        is written by logical record, without physical records that may later be modified.  If the file does
        exist, rtFile will be appended with checking the file format.</p>

<p>        Inputs:</p>
<p>            expDir - full path to experiment directory (as returned by createRTExperiment)</p>

<p>            rtFilename - basename of realtime file to be writtem</p>

<p>            rtFile - a string containing the new realtime file contents</p>


<p>        Returns: None</p>

<p>        Raises exception if rtFilename does not match one listed in fileTab.txt, or if format != unblocked binary
        when new file is created.</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
ValueError, 'Expected file %s to be UnblockedBinary, is %s' %( os.path.join( expDir, rtFilename ), filetype )<br>
ValueError, 'Filename %s not found in fileTab.txt' %( rtFilename )<br>
ValueError, 'Unable to open fileTab.txt in %s' %( expDir )<br>

</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="changeExpStatus"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">changeExpStatus&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
changeExpStatus (
        self,
        expDir,
        expUrl=None,
        expName=None,
        siteID=None,
        startDatetime=None,
        endDatetime=None,
        inst=None,
        security=None,
        )

</pre></font>
<h3>changeExpStatus is used to change attributes in expTab.txt.  If None, no change.</h3>
<p>        Inputs:</p>
<p>            expDir - full path to experiment directory. Required.  Example:
               &quot;/opt/madrigal/experiments/1998/mlh/20jan98&quot;. If None, do not change.</p>

<p>            expUrl - must be in form &lt;cgi base&gt;/madtoc/YYYY/&lt;3 letter lower case inst code&gt;/&lt;expDir&gt;
                       example: http://www.haystack.mit.edu/cgi-bin/madtoc/1997/mlh/03dec97g.
                       If None, do not change.</p>

<p>            expName - experiment name.  Quotes required if contains spaces.  Example: &quot;World Day&quot;
                        If None, do not change.</p>

<p>            siteID - Madrigal siteID (int) of where data will be stored.  Error raised if not the siteID
                       of the local Madrigal site. Example: 4. If None, do not change.</p>

<p>            startDatetime - new start datetime of experiment (UT). If None, do not change.</p>

<p>            endDatetime - new end datetime of experiment (UT). If None, do not change.</p>

<p>            inst - new instrument code (int).  Example: 30. If None, do not change.  Prints
                    warning if not found in instTab.txt</p>

<p>            security - new security code.  Allowed values are 0 for public, 1 for private (limited IP range access)
                    -1 for ignore, 2 for archived experiment, 3 for private (limited IP range access) archived
                    experiment. If None, do not change.</p>



<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
ValueError, 'Setting experiment to a siteID %i different from this site\'s id %i' %(siteID, self.__madDB.getSiteID() )<br>
ValueError, 'The experiment url you are setting this experiment to <%s> conflicts with experiment directory %s' %( expUrl, expDir )<br>
ValueError, 'Unable to open expTab.txt in %s' %( expDir )<br>
ValueError, 'expTab.txt in %s has %i experiments, should have exactly 1' %(expDir, expTabInfo.getExpCount() )<br>
ValueError, 'security must be in (-1, 0, 1, 2, 3), not %i' %( inst )<br>
ValueError, 'startDatetime %s must be before endDatetime %s' %(str( startDatetime ), str( endDatetime ) )<br>

</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="changeFileStatus"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">changeFileStatus&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
changeFileStatus (
        self,
        expDir,
        filename,
        category=None,
        fileDesc=None,
        permission=None,
        kindat=None,
        )

</pre></font>
<h3>changeFileStatus is used to change category, fileDesc, or permission of a register file in fileTab.txt.</h3>
<p>        Inputs:</p>
<p>            expDir - full path to experiment directory </p>

<p>            filename - basename of existing Madrigal file already registered in fileTab.txt</p>

<p>            permission - 0 (public) or 1 (private). If None (default), leave unchanged. </p>

<p>            fileDesc - file description. If None (default), leave unchanged.</p>

<p>            category - 1=default, 2=variant, or 3=history. If None (default), leave unchanged.</p>

<p>            kindat - kindat (int). If None (default), leave unchanged.</p>



<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
ValueError, 'Madrigal file %s not found in %s' %(filename, os.path.join( expDir, 'fileTab.txt' ) )<br>
ValueError, 'Unable to open fileTab.txt in %s' %( expDir )<br>

</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="createMadrigalExperiment"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">createMadrigalExperiment&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
createMadrigalExperiment (
        self,
        madFilename,
        expTitle,
        permission,
        fileDesc,
        instCode=None,
        category=1,
        optChar='',
        dirName=None,
        kindat=None,
        )

</pre></font>
<h3>createMadrigalExperiment creates a new experiment on Madrigal using metadata read from madFilename.</h3>
<p>        Inputs:</p>
<p>            madFilename - full path to the complete Madrigal file.  Basename will be maintained.</p>

<p>            expTitle - experiment title</p>

<p>            permission - 0 (public) or 1 (private) or -1 (ignore). </p>

<p>            fileDesc - file description</p>

<p>            instCode - instrument code.  If default (None), instrument code is taken from file, but error
            is thrown if more than one kinst found.</p>

<p>            category - 1=default, 2=variant, 3=history, or 4=realtime. Default is 1 (default file)</p>

<p>            optChar - optional character to be added to experiment directory if no dirName
                      given.  If dirName argument given, this argument ignored.  optChar
                      is used if the default directory name DDmmmYY is used for
                      more than one experiment created for a given instrument on a given day.
                      For example, if --optChar=h for a MLH experiment on September 12, 2005,
                      then the experiment directory created would be experiments/2005/mlh/12sep05h.</p>

<p>            dirName - directory name to use for experiment.  If None (the default), the directory
                      name will be the default name DDmmmYY[optChar].  Cannot contain &quot;/&quot;</p>

<p>            kindat - if not None (the default), use this kindat instead of what is found in the file.</p>


<p>        Returns:</p>
<p>            Full path to directory created</p>



<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        

            <table border="0" cellspacing="2" cellpadding="2" width="100%">
              <tr>
            <td align="LEFT" valign="TOP">
IOError, 'Directory %s already exists' %( expDir )<br>
ValueError, 'More than one kindat value found in file: %s' %(str( kindatList ) )<br>
ValueError, 'More than one kinst value found in file: %s' %(str( kinstList ) )<br>
ValueError, 'No kindat values found in file'<br>
ValueError, 'No kinst values found in file'<br>
ValueError, 'Unable to find mnemonic for kinst %i' %( instCode )<br>
ValueError, 'category must be 1=default, 2=variant, 3=history, or 4=realtime; not %s' %(str( category ) )<br>
ValueError, 'dirName must be base directory name, not %s' %( dirName )<br>
ValueError, 'expTitle not a string'<br>
ValueError, 'fileDesc not a string'<br>
</td>
<td align="LEFT" valign="TOP">
ValueError, 'optChar must be an empty or a one character string, not %s' %(str( optChar ) )<br>
ValueError, 'permission must be either 0 or 1 or -1, not %s' %(str( permission ) )<br>
</td>
</tr>
            </table>
            
</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="createRTExperiment"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">createRTExperiment&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
createRTExperiment (
        self,
        startTime,
        numDays,
        instrument,
        expTitle,
        rtFilenameList,
        kindatList,
        permissionList,
        fileDescList,
        optChar='',
        endTime=None,
        security=0,
        dirName=None,
        )

</pre></font>
<h3>createRTExperiment creates a new experiment on Madrigal in preparation for realtime data.</h3>
<p>        Since the experiment is presumably not yet complete, metadata such as the duration of the experiment
        must be estimated.  This metadata will be overwritten when the first batch file is added.</p>

<p>        Inputs:</p>
<p>            startTime - experiment start time.  If a number, assumed to be seconds since 1/1/1970.  May also
            be a datetime.datetime object</p>

<p>            numDays - number of days the experiment is estimated to run.  Ignored if optional endTime given.</p>

<p>            instrument - instrument code or 3-letter Madrigal mnenonic</p>

<p>            expTitle - experiment title</p>

<p>            rtFilenameList - list of realtime filenames to be created</p>

<p>            kindatList - list of ints of kindats for each realtime file.  Len = len(rtFilenameList)</p>

<p>            permissionList - list of 0 (public) or 1 (private). Len = len(rtFilenameList)</p>

<p>            fileDescList - list of realtime file descriptions</p>

<p>            optChar - optional character to be added to experiment directory if no dirName
                      given.  If dirName argument given, this argument ignored.  optChar
                      is used if the default directory name DDmmmYY is used for
                      more than one experiment created for a given instrument on a given day.
                      For example, if --optChar=h for a MLH experiment on September 12, 2005,
                      then the experiment directory created would be experiments/2005/mlh/12sep05h.</p>

<p>            endTime - optional end date and time of experiment.  If a number, assumed to be seconds since
            1/1/1970.  May also be a datetime.datetime object</p>

<p>            security - experiment security setting.  If 0 (the default) public.  If 1, private.
                       If -1, entire experiment ignored.  Any given file permission is the more
                       restricted of experiment permission and file permission.</p>

<p>            dirName - directory name to use for experiment.  If None (the default), the directory
                      name will be the default name DDmmmYY[optChar].  Cannot contain &quot;/&quot;</p>


<p>        Returns:</p>
<p>            Full path to directory created</p>



<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        

            <table border="0" cellspacing="2" cellpadding="2" width="100%">
              <tr>
            <td align="LEFT" valign="TOP">
'optChar must be an empty or a one character string, not %s' %(str( optChar ) )<br>
IOError, 'Directory %s already exists' %( expDir )<br>
ValueError, '%s not a legal instrument mnemonic or code' %(str( instrument ) )<br>
ValueError, '%s not a legal instrument mnemonic' %(str( instrument ) )<br>
ValueError, 'Experiment start time %s after end time %s' %(str( startTime ), str( endTime ) )<br>
ValueError, 'dirName must be base directory name, not %s' %( dirName )<br>
ValueError, 'expTitle not a string'<br>
ValueError, 'fileDescList must only contain strings'<br>
ValueError, 'kindatList must contain integers of value 0 (public) or 1 (private)'<br>
ValueError, 'kindatList must contain integers'<br>
</td>
<td align="LEFT" valign="TOP">
ValueError, 'length of fileDescList not equal length of rtFilenameList'<br>
ValueError, 'length of kindatList not equal length of rtFilenameList'<br>
ValueError, 'length of permissionList not equal length of rtFilenameList'<br>
ValueError, 'numDays must not be negative'<br>
ValueError, 'rtFilenameList cannot be empty'<br>
ValueError, 'rtFilenameList must contain strings without /'<br>
ValueError, 'rtFilenameList must contain strings'<br>
ValueError, 'rtFilenameList not a list or tuple'<br>
ValueError, 'security must be -1, 0, or 1, not %i' %( security )<br>
</td>
</tr>
            </table>
            
</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="overwriteMadrigalFile"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">overwriteMadrigalFile&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
overwriteMadrigalFile (
        self,
        expDir,
        madFilename,
        )

</pre></font>
<h3>overwriteMadrigalFile overwrites a file already registered in fileTab.txt.</h3>
<p>        Automatically updates expTab.txt with any start or end experiment times.</p>

<p>        Inputs:</p>
<p>            expDir - full path to experiment directory</p>

<p>            madFilename - full path to the new Madrigal file.  Basename must match that of one in fileTab.txt.</p>


<p>        Returns: None</p>

<p>        Affects: Overwrites existing Madrigal file.  May modify expTab.txt with new start/end times</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
ValueError, '%s not found in %s' %(filename, os.path.join( expDir, 'fileTab.txt' ) )<br>
ValueError, 'Unable to open fileTab.txt in %s' %( expDir )<br>

</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="removeMadrigalFile"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">removeMadrigalFile&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
removeMadrigalFile (
        self,
        expDir,
        madFilename,
        )

</pre></font>
<h3>removeMadrigalFile removes a file already registered in fileTab.txt.</h3>
<p>        Automatically updates expTab.txt with any start or end experiment times.</p>

<p>        Inputs:</p>
<p>            expDir - full path to experiment directory</p>

<p>            madFilename - Name of Madrigal file to be removed.  Basename must match that of one in fileTab.txt.</p>


<p>        Returns: None</p>

<p>        Affects: Removes existing Madrigal file and removes its line from fileTab.txt.  May modify expTab.txt
        with new start/end times</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
ValueError, 'Unable to open fileTab.txt in %s' %( expDir )<br>

</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="updateExpTab"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">updateExpTab&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
updateExpTab ( self,  expDir )

</pre></font>
<h3>updateExpTab rewrites expTab.txt based on all the Madrigal files registered in fileTab.txt.</h3>
<p>        Inputs:</p>
<p>            expDir - full path to experiment directory</p>


<p>        Returns: None</p>

<p>        Affects: rewrites expTab.txt in expDir based on all the Madrigal files registered in fileTab.txt.</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
ValueError, 'Unable to open expTab.txt in %s' %( expDir )<br>
ValueError, 'Unable to open fileTab.txt in %s' %( expDir )<br>

</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="updateMaster"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">updateMaster&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
updateMaster ( self,  skipGeo=False )

</pre></font>
<h3>updateMaster is a method to update the local metadata.</h3>
<p>        Replaces the former tcl script.</p>

<p>        Gathers data from experiment directories into metadata/expTab.txt and metadata/fileTab.txt.
        Also gathers metadata from OpenMadrigal to update metadata/expTabAll.txt and metadata/fileAllTab.txt,
        to update high level metadata siteTab.txt, instTab.txt, instType.txt, madCatTab.txt, parcods.tab.
        Also updates geophysical data.</p>



        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="writeRTMadrigalFile"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">writeRTMadrigalFile&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
writeRTMadrigalFile (
        self,
        expDir,
        rtFilename,
        rtFile,
        )

</pre></font>
<h3>writeRTMadrigalFile writes a realtime Madrigal file to a Madrigal experiment directory.</h3>
<p>        Fails if rtFilename does not match one listed in fileTab.txt.</p>

<p>        Inputs:</p>
<p>            expDir - full path to experiment directory (as returned by createRTExperiment)</p>

<p>            rtFilename - basename of realtime file to be writtem</p>

<p>            rtFile - a string containing the realtime file contents</p>


<p>        Returns: None</p>

<p>        Raises exception if rtFilename does not match one listed in fileTab.txt.</p>


<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
ValueError, 'Filename %s not found in fileTab.txt' %( rtFilename )<br>
ValueError, 'Unable to open fileTab.txt in %s' %( expDir )<br>

</td></tr>
</table>
</td></tr>
</td></tr>
</table>

        </td>
        </tr>
        </table>

        <hr>

        <p><i><a href="index.html">Table of Contents</a></i></p>

        <font size="-2"><i>This document was automatically generated
        on Wed Apr 15 11:04:01 2009 by
        <a href="http://happydoc.sourceforge.net">HappyDoc</a> version
        r1_5</i></font>
        
        </body>
        </html>
        
