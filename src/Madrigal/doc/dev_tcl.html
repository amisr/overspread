<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><!-- InstanceBegin template="/Templates/doc_template.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<!-- InstanceBeginEditable name="doctitle" -->
<title>Madrigal Tcl API </title>
<!-- InstanceEndEditable --><!-- InstanceBeginEditable name="head" --><!-- InstanceEndEditable -->
<link href="madrigal.css" rel="stylesheet" type="text/css" />
<!-- InstanceParam name="href_up_top" type="text" value="dev_contents.html" --><!-- InstanceParam name="href_next_top" type="text" value="dev_matlab.html" --><!-- InstanceParam name="href_back_top" type="text" value="dev_fortran.html" --><!-- InstanceParam name="href_back_bottom" type="text" value="dev_fortran.html" --><!-- InstanceParam name="href_up_bottom" type="text" value="dev_contents.html" --><!-- InstanceParam name="href_next_bottom" type="text" value="dev_matlab.html" --><!-- InstanceParam name="href_prev_top" type="text" value="dev_fortran.html" --><!-- InstanceParam name="href_uptitle_top" type="text" value="dev_contents.html" --><!-- InstanceParam name="href_nexttitle_top" type="text" value="dev_matlab.html" --><!-- InstanceParam name="href_prevtitle_bottom" type="text" value="dev_fortran.html" --><!-- InstanceParam name="href_uptitle_bottom" type="text" value="dev_contents.html" --><!-- InstanceParam name="href_nexttitle_bottom" type="text" value="dev_matlab.html" -->
</head>

<body>
<table width="100%" border="1" cellpadding="0" cellspacing="2" class="navigation">
  <tr>
    <td width="5%"><a href="dev_fortran.html"><img src="icons/previous.png" alt="previous" width="32" height="32" /></a></td>
    <td width="5%"><a href="dev_contents.html"><img src="icons/up.png" alt="up" width="32" height="32" /></a></td>
    <td width="5%"><a href="dev_matlab.html"><img src="icons/next.png" alt="next" width="32" height="32" /></a></td>
    <td width="54%"><!-- InstanceBeginEditable name="EditTitleTop" -->Madrigal Tcl API <!-- InstanceEndEditable --></td>
    <td width="13%"><a href="/MADSERVERROOT/madContents.html">Doc home </a></td>
    <td width="18%"><a href="/MADSERVERROOT">Madrigal home</a></td>
  </tr>
</table>
<div class='online-navigation'>
<b class="navlabel">Previous:</b>
<a class="sectref" href="dev_fortran.html"><!-- InstanceBeginEditable name="PreviousTitle" -->Fortran API <!-- InstanceEndEditable --></A>
<b class="navlabel">&nbsp;&nbsp;Up:</b>
<a class="sectref" href="dev_contents.html"><!-- InstanceBeginEditable name="UpTitle" -->Madrigal developer's guide <!-- InstanceEndEditable --></A>
<b class="navlabel">&nbsp;&nbsp;Next:</b>
<a class="sectref" href="dev_matlab.html"><!-- InstanceBeginEditable name="NextTitle" -->Matlab API <!-- InstanceEndEditable --></A></div>
<hr/>
<!-- InstanceBeginEditable name="EditDoc" -->
<h1 align="center">Madrigal Tcl API </h1>
<center>
<h1>Madrigal extensions to Tcl (madtclsh)</h1>
</center>

<hr size="4">
Madtclsh is an extended tcl interpreter which adds direct
support for manipulating Cedar database files and their contents.
This executable is located in <em>madroot</em>/bin. There are eight new commands: 

<ul>
<li>mad</li>

<li>cedarCode</li>

<li>getKey</li>

<li>isr_point</li>

<li>isr_look</li>

<li>isr_geodetic2geocentric</li>

<li>isr_geocentric2geodetic</li>

<li>isr_dircos</li>
</ul>

<p>The first two commands create new tcl objects which can be used
to manipulate Cedar files (mad) and Cedar metacode information
(cedarCode). The remaining commands determine the Madrigal key
given a time and date (getKey) and provide basic geometry and
geographic coordinate functions (isr_point, isr_look,
isr_geodetic2geocentric, isr_geocentric2geodetic and
isr_dircos).</p>

<p>The script shown below, summarizeCedarFile, illustrates the use
of madtclsh. It begins by creating a new madrec object (mad madin).
More than one madrec object can be created. For example, a script
to translate a Cedar file from Madrigal to Cedar Ascii format would
require two. The mad command creates a new tcl command - $madin in
the example. Typically the first thing done with the new command is
to associate it with a Cedar file ($madin open 1 $infile). The file
can then be read using the getNextRecord subcommand ($madin
getNextRecord). Once a record has read, numerous subcommands are
available to extract information from the record (e.g. $madin get
startTime). When the file is no longer needed, it can be
disassociated from the madrec object ($madin close). Finally, when
the madrec object is no longer needed, it can be destroyed ($madin
destroy).</p>

<pre>
#!/bin/sh
# The madtclsh path is longer than 32 characters. So, we take advantage
# of the fact that a backslash continues a comment line in tcl \
exec /opt/madrigal/bin/madtclsh "$0" ${1+"$@"}

# summarizeCedarFile prints a one line per record summary of a CEDAR
# file.  The file may be any of the 5 supported CEDAR formats (Madrigal,
# Blocked Binary, Cbf, Unblocked Binary or ASCII"), and may include any
# mixture of prologue, header and data records. The format of the file is
# determined automatically.

# Usage: printCedarRecords filename firstRecord lastRecord

# Get parameter codes
cedarCode cedarCode

# Get number of parameters
set nargs $argc
if {$nargs != 1} {
    puts {Usage: summarizeCedarFile filename}
    exit
}

# Get file name from the argument list
set infile [lindex $argv 0]

# Create madrec object for the input file. Specify file type 1 for automatic
# determination of the CEDAR file type
mad madin
catch [$madin open 1 $infile]

# Print a one line per record summary of the file
puts "  rec     Start Time            End Time      kinst krec kindat"
set rec 0
while {[set status [$madin getNextRecord]] == 0} {
    incr rec
    set recno [format %4d $rec]
    set startTime [$madin get startTime]
    set yr1 [lindex $startTime 0]
    set mo1 [lindex $startTime 1]
    set dy1 [lindex $startTime 2]
    set hr1 [lindex $startTime 3]
    set mn1 [lindex $startTime 4]
    set sc1 [lindex $startTime 5]
    set zero 0
    if {[string length $hr1] == 1} {
        set hr1 $zero$hr1
    }
    if {[string length $mn1] == 1} {
        set mn1 $zero$mn1
    }
    if {[string length $sc1] == 1} {
        set sc1 $zero$sc1
    }
    set endTime [$madin get endTime]
    set yr2 [lindex $endTime 0]
    set mo2 [lindex $endTime 1]
    set dy2 [lindex $endTime 2]
    set hr2 [lindex $endTime 3]
    set mn2 [lindex $endTime 4]
    set sc2 [lindex $endTime 5]
    set zero 0
    if {[string length $hr2] == 1} {
        set hr2 $zero$hr2
    }
    if {[string length $mn2] == 1} {
        set mn2 $zero$mn2
    }
    if {[string length $sc2] == 1} {
        set sc2 $zero$sc2
    }
    puts "$recno  $mo1/$dy1/$yr1 $hr1:$mn1:$sc1  $mo2/$dy2/$yr2 $hr2:$mn2:$sc2 \
         [$madin get kinst] \
         [$madin get krec] \
         [$madin get kindat]"
}

# Close file and delete madrec object
$madin close
$madin destroy</pre>
<center>
<h1>madtclsh Commands</h1>
</center>

<ul>
<li><b><i>mad</i></b><br>
mad <i>madObj</i>: Creates a madrec object, i.e. a new Tcl command
named madObj. 

<ul>
<li><b>destroy</b><br>
 madObj destroy - destroys madObj.</li>

<li><b>open</b><br>
 madObj open <i>fileType fileName</i> - opens Cedar file fileName
and associates it with madObj.<br>
 The following file types are supported: 

<ul>
<li>Open Cedar file for sequential and random reading: 

<ul>
<li>1 - Determine file type automatically</li>

<li>10 - Madrigal file</li>

<li>11 - Blocked Binary file</li>

<li>12 - Cbf file</li>

<li>13 - Unblocked Binary file</li>

<li>14 - Ascii file</li>
</ul>

Create Cedar file for update; discard previous contents if any: 

<ul>
<li>2 - Madrigal file</li>

<li>20 - Madrigal file</li>

<li>21 - Blocked Binary file</li>

<li>22 - Cbf file</li>

<li>23 - Unblocked Binary file</li>

<li>24 - Ascii file</li>

<li>25 - Unblocked Binary file image in memory. Supports sequential
read and write, sequential and random read.</li>

<li>26 - Unblocked Binary file image in memory. Supports sequential
read and write, sequential and random read and in place edits.</li>
</ul>
</li>
</ul>
</li>

<li><b>close</b><br>
 madObj close - closes the file associated with madObj and
disassociates it from madObj.</li>

<li><b>getNextRecord</b><br>
 madObj getNextRecord - reads the next Cedar record and fills a
Madrec structure with the information in the record.</li>

<li><b>putNextRecord</b><br>
 madObj putNextRecord - writes (appends) the current Cedar record
to a file.</li>

<li><b>getPreviousRecord</b><br>
 madObj getPreviousRecord - reads the previous Cedar record and
fills a Madrec structure with the information in the record.</li>

<li><b>getRecordByRecno</b><br>
 madObj getRecordByRecno <i>recordNumber</i> - reads the specified
Cedar record and fills a Madrec structure with the information in
the record.</li>

<li><b>getRecordByKey</b><br>
 madObj getRecordByKey <i>key</i> - reads the specified Cedar
record and fills a Madrec structure with the information in the
record.</li>

<li><b>rewind</b><br>
 madObj rewind - positions the file at the first record.</li>

<li><b>copy</b><br>
 madObj copy madObjOut - copies the currect CEDAR record from
madObj to madObjOut.</li>

<li><b>checkRecord</b><br>
 madObj checkRecord - checks the current CEDAR record for
compliance with the standard. Returns 0 if the record is
compliant.</li>

<li><b>parmCodeArray</b><br>
 madObj parmCodeArray - Under development.</li>

<li><b>parmArray</b><br>
 madObj parmArray - Under development.</li>

<li><b>printProlog</b><br>
 madObj printProlog - Prints the prolog of the current CEDAR
record.</li>

<li><b>createRecord</b><br>
 madObj createRecord <i>parmList</i> - Creates a new CEDAR record
using the parameters in parmList.</li>

<li><b>printRecord</b><br>
 madObj printRecord <i>options</i> - Prints an ASCII version of the
current CEDAR record. Options: -d - decimal -h - hex</li>

<li><b>get</b><br>
 madObj get <i>parameter</i> - Gets the specified parameter from
the current CEDAR record. 

<ul>
<li><i>numBlocks</i><br>
</li>

<li><i>fileType</i><br>
</li>

<li><i>missing</i><br>
</li>

<li><i>error</i><br>
</li>

<li><i>numParms</i><br>
</li>

<li><i>parmsList</i><br>
</li>

<li><i>parmLoc</i><br>
</li>

<li><i>parmMin</i><br>
</li>

<li><i>parmMax</i><br>
</li>

<li><i>startTime</i><br>
</li>

<li><i>endTime</i><br>
</li>

<li><i>startIndex</i><br>
</li>

<li><i>endIndex</i><br>
</li>

<li><i>ltot</i><br>
</li>

<li><i>krec</i><br>
</li>

<li><i>kinst</i><br>
</li>

<li><i>kindat</i><br>
</li>

<li><i>ibyr</i><br>
</li>

<li><i>ibdt</i><br>
</li>

<li><i>ibhm</i><br>
</li>

<li><i>ibcs</i><br>
</li>

<li><i>ieyr</i><br>
</li>

<li><i>iedt</i><br>
</li>

<li><i>iehm</i><br>
</li>

<li><i>iecs</i><br>
</li>

<li><i>lprol</i><br>
</li>

<li><i>jpar</i><br>
</li>

<li><i>mpar</i><br>
</li>

<li><i>nrow</i><br>
</li>

<li><i>kpar</i><br>
</li>

<li><i>word</i><br>
</li>

<li><i>startJday</i><br>
</li>

<li><i>endJday</i><br>
</li>

<li><i>header</i><br>
</li>

<li><i>parcodes1d</i><br>
</li>

<li><i>parcodes2d</i><br>
</li>

<li><i>parm1d</i><br>
</li>

<li><i>parm2d</i><br>
</li>

<li><i>1dInt</i><br>
</li>

<li><i>2dInt</i><br>
</li>
</ul>
</li>

<li><b>set</b><br>
 madObj set <i>parameter value</i> - Sets the specified parameter
in the current CEDAR record. 

<ul>
<li><i>krec</i><br>
</li>

<li><i>kinst</i><br>
</li>

<li><i>kindat</i><br>
</li>

<li><i>startTime</i><br>
</li>

<li><i>endTime</i><br>
</li>

<li><i>1dParm</i><br>
</li>

<li><i>2dParm</i><br>
</li>

<li><i>1dInt</i><br>
</li>

<li><i>2dInt</i><br>
</li>
</ul>
</li>
</ul>
</li>

<li><b><i>cedarCode</i></b><br>
 

<ul>
<li><i>destroy</i><br>
</li>

<li><i>numCodes</i><br>
</li>

<li><i>code</i><br>
</li>

<li><i>codeIndex</i><br>
</li>

<li><i>type</i><br>
</li>

<li><i>scaleFactor</i><br>
</li>

<li><i>units</i><br>
</li>

<li><i>description</i><br>
</li>

<li><i>int16Description</i><br>
</li>

<li><i>mnemonic</i><br>
</li>

<li><i>format</i><br>
</li>

<li><i>width</i><br>
</li>
</ul>
</li>

<li><b><i>getKey</i></b><br>
</li>

<li><b><i>isr_point</i></b><br>
</li>

<li><b><i>isr_look</i></b><br>
</li>

<li><b><i>isr_geodetic2geocentric</i></b><br>
</li>

<li><b><i>isr_geocentric2geodetic</i></b><br>
</li>

<li><b><i>isr_dircos</i></b><br>
</li>
</ul>

<p>Further details of the Madrigal Tcl are found by examining the <a href="http://www.haystack.mit.edu/cgi-bin/madrigal_viewcvs.cgi/madroot/source/madtcl/">tcl source code</a> from <a href="http://www.openmadrigal.org/">OpenMadrigal</a>. <br>
    <br>
</p>
<!-- InstanceEndEditable -->
<table width="100%" border="1" cellpadding="0" cellspacing="2" class="navigation">
  <tr>
    <td width="5%"><a href="dev_fortran.html"><img src="icons/previous.png" alt="previous" width="32" height="32" /></a></td>
    <td width="5%"><a href="dev_contents.html"><img src="icons/up.png" alt="up" width="32" height="32" /></a></td>
    <td width="5%"><a href="dev_matlab.html"><img src="icons/next.png" alt="next" width="32" height="32" /></a></td>
    <td width="54%"><!-- InstanceBeginEditable name="EditTitleBottom" -->Madrigal Tcl API <!-- InstanceEndEditable --></td>
    <td width="13%"><a href="/MADSERVERROOT/madContents.html">Doc home </a></td>
    <td width="18%"><a href="/MADSERVERROOT">Madrigal home</a></td>
  </tr>
</table>
<div class='online-navigation'>
<b class="navlabel">Previous:</b>
<a class="sectref" href="dev_fortran.html"><!-- InstanceBeginEditable name="PreviousTitle2" -->Fortran API <!-- InstanceEndEditable --></A>
<b class="navlabel">&nbsp;&nbsp;Up:</b>
<a class="sectref" href="dev_contents.html"><!-- InstanceBeginEditable name="UpTitle2" -->Madrigal developer's guide <!-- InstanceEndEditable --></A>
<b class="navlabel">&nbsp;&nbsp;Next:</b>
<a class="sectref" href="dev_matlab.html"><!-- InstanceBeginEditable name="NextTitle2" -->Matlab API <!-- InstanceEndEditable --></A></div>
<hr/>
<p>&nbsp;</p>
</body>
<!-- InstanceEnd --></html>
